<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="utf-8">
        <title>"Disqus yorumlarının görünür olduklarında yüklenmesi"</title>
        <meta charset="utf-8" />
        <link href='http://fonts.googleapis.com/css?family=ABeeZee|Carrois+Gothic|Source+Code+Pro:400,700' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="../../theme/style/reset.css" type="text/css" />
        <link rel="stylesheet" href="../../theme/style/screen.css" type="text/css" />
        <link rel="stylesheet" href="../../theme/style/pygment.css" type="text/css" />
        <link rel="stylesheet" href="../../theme/style/pygment-monokai.css" type="text/css" />
        <link rel="stylesheet" href="../../theme/style/print.css" type="text/css" media="print" />
                                <!--[if IE]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
</head>
<body>
    <header id="main">
        <div class="container">
            <div class="logo">
                <a href="/" title="Home">web development notes</a>
            </div>
        </div>
    </header>

    <div class="splash">
        <div class="container">
            <div class="welcome">by Murat Çorlu</div>
        </div>
    </div>

    <div class="container content">
        <article>
    <header>
        <h2><a href="/post/disqus-yorumlarinin-gorunur-olduklarinda-yuklenmesi/" rel="bookmark">
    "Disqus yorumlarının görünür olduklarında yüklenmesi"
</a></h2>
<time datetime="2012-04-03 11:26:00" pubdate>Posted on
    Tue 03 April 2012
</time>
<address class="vcard author">
    by <a class="url fn" href="../../author/murat-corlu.html">
    Murat Çorlu</a>
</address>
<span class="category">in <a href="../../category/posts.html">
    posts</a>.
        </span>
    </header>

    <div class="body">
        <p><a href="http://disqus.com">Disqus</a>, artık bir çok blogda kullanılan çok başarılı bir yorumlama hizmeti. Özellikle statik blogların yaygınlaştığı günümüzde, dinamik üretilmeyen sayfalarda bile yorum yazılabilmesi imkanı verdiği için hayat kurtarıcı bir çözüm.</p>
<p>Disqus'ın sunduğu javascript kodunu kullandığınızda sayfa yüklenirken yorumların olacağı yere gelindiğinde Disqus tarafından sunulan javascript dosyası yükleniyor ve bu dosya ihtiyaç duyduğu dosyaları da yükletip, yorumları sayfaya ekliyor. Bloglarda genelde bir yazı açıldığında yazının uzunluğundan dolayı yorumlar ilk anda görüntüde olmuyorlar. Ancak bu geleneksel yöntemimizde birşeyi değiştirmiyor ve görüntüde olmamasına rağmen yorumlar sayfa açılırken yükleniyor. İçinde başka öğelerin de bulunduğu(videolar, resimler ve başka javascriptler) uzun yazılı blog sayfalarını açarken, görüntüde olmadığı halde Disqus yorumlarının da ilk açılışta yükleniyor olması hissedilir bir yük oluşturuyor. İşte buna çözüm olarak, <a href="http://jquery.com">jQuery</a> kütüphanesinden ve Mike Green'in <a href="http://www.myatus.com/2011/03/20/lazy-loading-disqus-in-wordpress/">bir yazısı</a>ndan faydalanarak yazdığım aşağıdaki javascript dosyası ve HTML5'in data attribute özelliğinden faydalandığım aşağıdaki gibi bir HTML yazımı ile Disqus yorumlarını kullanıcı sayfayı yorumların olduğu bölümlere kaydırdığı anda yükletebilirsiniz:</p>
<div class="codehilite"><pre><span class="cm">/**</span>
<span class="cm">* Load disqus comments when visitor scroll down page to comments</span>
<span class="cm">*</span>
<span class="cm">* Usage:</span>
<span class="cm">* Add a div with id &quot;disqus_thread&quot; and data attributes for every disqus parameter:</span>
<span class="cm">*</span>
<span class="cm">* &lt;div id=&quot;disqus_thread&quot; data-disqus-shortname=&quot;username&quot; data-disqus-url=&quot;http://example.com/post/post-name/&quot;&gt;&lt;/div&gt;</span>
<span class="cm">*</span>
<span class="cm">* @author: Murat Corlu</span>
<span class="cm">* @link: https://gist.github.com/gists/2290198</span>
<span class="cm">*/</span>
<span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">disqus_div</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#disqus_thread&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">disqus_div</span><span class="p">.</span><span class="nx">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ds_loaded</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
            <span class="nx">top</span> <span class="o">=</span> <span class="nx">disqus_div</span><span class="p">.</span><span class="nx">offset</span><span class="p">().</span><span class="nx">top</span><span class="p">,</span> <span class="c1">// WHERE TO START LOADING</span>
            <span class="nx">disqus_data</span> <span class="o">=</span> <span class="nx">disqus_div</span><span class="p">.</span><span class="nx">data</span><span class="p">(),</span>
            <span class="nx">check</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
                <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">ds_loaded</span> <span class="o">&amp;&amp;</span> <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">scrollTop</span><span class="p">()</span> <span class="o">+</span> <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">height</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nx">top</span> <span class="p">)</span> <span class="p">{</span>
                    <span class="nx">ds_loaded</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">disqus_data</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">key</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;disqus&#39;</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nb">window</span><span class="p">[</span><span class="s1">&#39;disqus_&#39;</span> <span class="o">+</span> <span class="nx">key</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;disqus&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">()]</span> <span class="o">=</span> <span class="nx">disqus_data</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
                        <span class="p">}</span>
                    <span class="p">}</span>

                    <span class="kd">var</span> <span class="nx">dsq</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">);</span>
                    <span class="nx">dsq</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s1">&#39;text/javascript&#39;</span><span class="p">;</span>
                    <span class="nx">dsq</span><span class="p">.</span><span class="nx">async</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                    <span class="nx">dsq</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s1">&#39;http://&#39;</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">disqus_shortname</span> <span class="o">+</span> <span class="s1">&#39;.disqus.com/embed.js&#39;</span><span class="p">;</span>
                    <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;head&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">||</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]).</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">dsq</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">};</span>

        <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">scroll</span><span class="p">(</span><span class="nx">check</span><span class="p">);</span>
        <span class="nx">check</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>


<p>Bu da html tarafı:</p>
<div class="codehilite"><pre><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;disqus_thread&quot;</span> <span class="na">data-disqus-shortname=</span><span class="s">&quot;muratcorlu&quot;</span> <span class="na">data-disqus-url=</span><span class="s">&quot;http://muratcorlu.com/post/post-name/&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
</pre></div>


<p>HTML5 ile gelen data attribute'ları bu tür ihtiyaçlar için biçilmiş kaftan. Ancak eğer HTML dokümanlarınızı HTML5 tipinde deklare etmiyorsanız bu attribute'ları kullanmak dosyanızın validasyonunu bozacaktır. Bunun yanında normalde IE7'nin data attribute desteği olmamasına rağmen jQuery bu problemi çözmektedir.</p>
<p>Bu çözümü <del>şu anki blog üretme motorum olan</del> <a href="http://octopress.org">Octopress</a>'de nasıl uyguladığımı görmek isterseniz Github'daki bu iş için yaptığım değişikliklerden ibaret olan <a href="https://github.com/muratcorlu/muratcorlu.github.com/commit/381b1eb24292db1436d83deeeacdceca836e901c">commitimi</a> inceleyebilirsiniz.</p>
    </div>

        <footer>
        <ul class="tags">
                    <li><a href="../../tag/disqus.html">disqus</a></li>
                    <li><a href="../../tag/javascript.html">javascript</a></li>
                    <li><a href="../../tag/octopress.html">octopress</a></li>
                    <li><a href="../../tag/jquery.html">jquery</a></li>
                </ul>
    </footer>
    
        <div class="share">
        <a href="https://twitter.com/share" class="twitter-share-button"
           data-count="horizontal" data-text=""Disqus yorumlarının görünür olduklarında yüklenmesi""
           data-via="muratcorlu">Tweet</a>
    </div>
    <script src="//platform.twitter.com/widgets.js"></script>
    
        <div id="disqus_thread"></div>
    <script>
        var disqus_identifier = "http://muratcorlu.com/post/disqus-yorumlarinin-gorunur-olduklarinda-yuklenmesi/",
            disqus_developer = "1";

        (function () {
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.src = 'http://muratcorlu.disqus.com/embed.js';
            (document.head || document.body).appendChild(dsq);
        })();
    </script>
    </article>

<script>
    (function () {
        'use strict';
        var titleElm = document.querySelector('article > header');
        var bodyElm = document.querySelector('article > .body');
        if (!titleElm || !bodyElm)
            return;

        var limit = titleElm.offsetTop;
        var titleCls = titleElm.classList;
        var bodyCls = bodyElm.classList;
        var floating = false;
        window.onscroll = function (evt) {
            var scrollTop = Math.max(document.body.scrollTop,
                    document.documentElement.scrollTop);
            if (!floating && limit < scrollTop) {
                titleCls.add('float');
                bodyCls.add('body-padding');
                floating = true;
            }
            else if (limit >= scrollTop) {
                titleCls.remove('float');
                bodyCls.remove('body-padding');
                floating = false;
            }
        };
    })();
</script>
    </div>

    <div class="container footnote">
                            </div>

    <div class="bottom">
        <div class="container">
                        <div class="github-badge">
                <iframe src="http://githubbadge.appspot.com/badge/muratcorlu?s=1"
                        style="border: 0; height: 150px; width: 200px; overflow: hidden;"></iframe>
            </div>
                        <div class="about">
                <h3>About me</h3>
                <img alt="Me!" class="avatar"
                     src="http://www.gravatar.com/avatar/2906955ae59c795275979d3782d7bfca?size=64">
                <p>
I'm web developer at sahibinden.com. I love Javascript and Python.
</p>
                <p>
                   You can contact me by emailing
                   <a href="mailto:muratcorlu@gmail.com">muratcorlu@gmail.com</a>.
                </p>
                <p>
                                        <a href="https://twitter.com/muratcorlu"
                       title="@muratcorlu on Twitter">Follow me on Twitter</a> and
                                                            <a href="https://github.com/muratcorlu"
                       title="muratcorlu's Profile">fork me on GitHub
                    </a>!
                                    </p>
            </div>
        </div>
    </div>

    <footer>
        <div class="container footer">
            <span>Powered by <a href="http://docs.getpelican.com">
                Pelican</a> using <a href="https://github.com/BYK/pelican-neat">
                neat theme</a>.
            </span>
            <nav>
                <ul>
                    <li><a href="archives.html" title="Archive"><strong>Archive</strong></a></li>
                                    </ul>
            </nav>
                    </div>
    </footer>

        <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-790007-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    </body>
</html>