<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="utf-8">
        <title>"Django'da Haystack ve Elasticsearch ile arama"</title>
        <meta charset="utf-8" />
        <link href='http://fonts.googleapis.com/css?family=ABeeZee|Carrois+Gothic|Source+Code+Pro:400,700' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="../../theme/style/reset.css" type="text/css" />
        <link rel="stylesheet" href="../../theme/style/screen.css" type="text/css" />
        <link rel="stylesheet" href="../../theme/style/pygment.css" type="text/css" />
        <link rel="stylesheet" href="../../theme/style/pygment-monokai.css" type="text/css" />
        <link rel="stylesheet" href="../../theme/style/print.css" type="text/css" media="print" />
                                <!--[if IE]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
</head>
<body>
    <header id="main">
        <div class="container">
            <div class="logo">
                <a href="/" title="Home">web development notes</a>
            </div>
        </div>
    </header>

    <div class="splash">
        <div class="container">
            <div class="welcome">by Murat Çorlu</div>
        </div>
    </div>

    <div class="container content">
        <article>
    <header>
        <h2><a href="/post/djangoda-haystack-ve-elasticsearch-ile-arama/" rel="bookmark">
    "Django'da Haystack ve Elasticsearch ile arama"
</a></h2>
<time datetime="2012-03-28 23:57:00" pubdate>Posted on
    Wed 28 March 2012
</time>
<address class="vcard author">
    by <a class="url fn" href="../../author/murat-corlu.html">
    Murat Çorlu</a>
</address>
<span class="category">in <a href="../../category/posts.html">
    posts</a>.
        </span>
    </header>

    <div class="body">
        <p>Django, verilere hızlıca erişim ve düzenleme için çok güzel bir model katmanına sahip. Her ne kadar bu modellerde filtreleme imkanları oldukça kullanışlı görünse de, büyük veri ve yoğun kullanımlarda veritabanından sorgular yaparak arama yapma devri geçmişte kaldı. Çünkü artık küçük verilere çok daha hızlı erişebilen ve arama konusu üzerine uzmanlaşmış bir çok başarılı uygulama var. Bunlara en bilinen örnekler olarak <a href="http://lucene.apache.org/solr/">Solr</a>, <a href="http://sphinxsearch.com">Sphinx</a> ve henüz bunlara göre toy olmasına rağmen performansı ve kullanım kolaylığıyla bir çok yazılımcıyı büyüleyen <a href="http://elasticsearch.org">Elasticsearch</a> uygulamalarını verebiliriz. Ben bu yazımda yakın zamanda kullanmaya başladığım Elasticsearch'den ve Elasticsearch'ü Django'da nasıl kullanabileceğimizden bahsedeceğim.</p>
<!--more-->

<p>Elasticsearch, <a href="http://lucene.apache.org">Apache Lucene</a> projesinin üzerine bina edilmiş, kendini arama konusuna adamış, açık kaynak, REST arayüzlü, dağıtık çalışabilen, şema bağımsız veri taşıyabilen, Java tabanlı oldukça başarılı bir arama motoru. Elasticsearch REST tabanlı olduğu için, herhangi bir programlama diliyle kolayca entegre edilebiliyor. Python için yazılmış istemcilere verilecek ilk örnekler <a href="http://github.com/aparo/pyes">pyes</a> ve <a href="http://github.com/rhec/pyelasticsearch">pyelasticsearch</a>.<a href="http://www.elasticsearch.org/guide/appendix/clients.html" title="Diğer diller için liste [İngilizce]">*</a></p>
<p><a href="http://haystacksearch.org/">Django-Haystack</a> uygulaması ise, Django'da Elasticsearch ve benzeri bir çok arama motorunu kolayca kullanabilmek için oluşturulmuş bir ara katman. Haystack uygulamasını kullanarak seçtiğimiz veya ileride seçeceğimiz arama motorumuz ne olursa olsun, aynı metodları kullanarak işimizi görebiliyoruz. Aynı anda birden fazla arama motorunu kullanmaya imkan vermesi sayesinde de, uygulamamızın bir kısmında Solr kullanırken, diğer bölümünde Elasticsearch kullanabiliyoruz ve bunun için atılması düşünülen bir çok takladan kurtulmuş oluyoruz.</p>
<p>Şimdi kolları sıvayıp, django-haystack ve elasticsearch ile küçük bir arama uygulaması yapalım.</p>
<h2>Kurulum</h2>
<p>Django-haystack uygulamasını <code>pip install django-haystack</code> komutu ile kolayca kurabiliyoruz. Ancak, haystack uygulamasının şu anki(Mart 2012) son kararlı sürümü olan 1.2.6 sürümünün içinde elasticsearch arayüzü hazır olarak gelmediğinden ben burada şu an beta sürümünde olan 2.0 sürümü üzerinden anlatacağım. 2.0 sürümünü de haystack'in github deposundan, yine pip ile <code>pip install -e git+https://github.com/toastdriven/django-haystack.git@master#egg=django-haystack</code> komutu ile kurabiliriz.</p>
<p>Elasticsearch Java ortamı gerektirmektedir ancak kendi içinde işini görebilecek boyutta bir Java ortamı ile beraber geliyor. Elasticsearch'ün dilediğiniz versiyonunun sıkıştırılmış dosyasını <a href="http://www.elasticsearch.org/download/">indirme sayfasından</a> edinip, bilgisayarınızda herhangi bir yere açtıktan sonra, açılan dosyalardan bin klasöründeki elasticsearch uygulamasını çalıştırarak kolayca başlatmış olursunuz.<a href="http://www.elasticsearch.org/guide/reference/setup/installation.html" title="Ayrıntılı bilgi [İngilizce]">*</a> Kurulu versiyon için MacOSX'de brew (<code>brew install elasticsearch</code>), Ubuntu'da da aptitude (<code>apt-get install elasticsearch</code>) kullanabilirsiniz. Elasticsearch'ü  kurduktan sonra python ile kullanabilmek için pyelasticsearch modülüne de ihtiyacımız olacak. Onun haystack uyumlu versiyonunu da aşağıdaki komutlarla kurabilirsiniz:</p>
<div class="codehilite"><pre>git clone https://github.com/toastdriven/pyelasticsearch
<span class="nb">cd </span>pyelasticsearch
python setup.py install
</pre></div>


<h2>Ayarlar</h2>
<p>Haystack uygulamasını settings.py dosyasımızdaki INSTALLED_APPS listemize ekliyoruz. Buna ek olarak bir de HAYSTACK_CONNECTIONS değişkeni ile Elasticsearch bağlantı bilgilerimizi vermemiz gerekiyor:</p>
<div class="codehilite"><pre><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.sites&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
    <span class="c"># Uncomment the next line to enable the admin:</span>
    <span class="s">&#39;django.contrib.admin&#39;</span><span class="p">,</span>
    <span class="c"># Uncomment the next line to enable admin documentation:</span>
    <span class="c"># &#39;django.contrib.admindocs&#39;,</span>

    <span class="s">&#39;haystack&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">HAYSTACK_CONNECTIONS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s">&#39;haystack.backends.elasticsearch_backend.ElasticsearchSearchEngine&#39;</span><span class="p">,</span>
        <span class="s">&#39;URL&#39;</span><span class="p">:</span> <span class="s">&#39;http://127.0.0.1:9200/&#39;</span><span class="p">,</span>
        <span class="s">&#39;INDEX_NAME&#39;</span><span class="p">:</span> <span class="s">&#39;blog&#39;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>


<p>Elasticsearch varsayılan olarak 9200 portundan çalışıyor. INDEX_NAME değeri de veritabanı adı gibi düşünülebilir. Elasticsearch'ün varsayılan ayarlarında çalışması deneme yapabilmemiz için yeterli.</p>
<p>Haystack uygulamasının vereceğimiz index tanımlarını otomatik tanıması için, Django uygulamamızın ana klasörüne(settings.py ile aynı yere) aşağıdaki içerikte search_sites.py adlı dosyamızı oluşturalım:</p>
<div class="codehilite"><pre><span class="kn">import</span> <span class="nn">haystack</span>

<span class="n">haystack</span><span class="o">.</span><span class="n">autodiscover</span><span class="p">()</span>
</pre></div>


<h2>Verilerin indekslenmesi</h2>
<p>Örneğimizde bir blog uygulamamız olacak ve blog yazılarının başlıklarında bir arama yapacağız. Yazımız için modelimiz aşağıdaki gibi olsun:</p>
<div class="codehilite"><pre><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>

<span class="k">class</span> <span class="nc">BlogPost</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">create_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">modified_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>


<p>Modelimizi oluşturduktan sonra syncdb komutuyla veritabanını senkronize edip yönetici panelinden de deneme için birkaç yazı ekleyebilirsiniz.</p>
<p>Arama motorları aramada kullanılacak verileri kendi içine, belirledikleri algoritmalarla alırlar ve bu veriler üzerinde arama yapma imkanı verirler. Bu işleme indeksleme denir. Biz de şimdi BlogPost modelimizden hangi verileri indeksimize alacağımızı belirteceğiz. Bu işlemi uygulama klasörünün içine search_indexes.py adlı bir dosya açarak yapıyoruz:</p>
<div class="codehilite"><pre><span class="kn">from</span> <span class="nn">haystack</span> <span class="kn">import</span> <span class="n">indexes</span>
<span class="kn">from</span> <span class="nn">blog.models</span> <span class="kn">import</span> <span class="n">BlogPost</span>

<span class="k">class</span> <span class="nc">PostIndex</span><span class="p">(</span><span class="n">indexes</span><span class="o">.</span><span class="n">RealTimeSearchIndex</span><span class="p">,</span> <span class="n">indexes</span><span class="o">.</span><span class="n">Indexable</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">indexes</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">document</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">use_template</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">indexes</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">model_attr</span><span class="o">=</span><span class="s">&#39;title&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">BlogPost</span>
</pre></div>


<p>Örneğimizde PostIndex adlı bir indeks oluşturduk. Bunu haystack'in RealTimeSearchIndex sınıfını miras alarak oluşturduğumuz için modelimizdeki değişikliklerde(yazı eklenmesi, silinmesi gibi) Elasticsearch indeksimiz otomatik olarak güncellenecek. Haystack indeks tanımlamalarında get_model metodu yazılarak ilgili modelin belirtilmesi ve mutlaka bir adet text adlı alan bulunması zorunludur. Bu alan varsayılan olarak üzerinde arama yapılacak alandır. Bu alana verdiğimiz use_template parametresi bu alan için oluşturacağımız bir template dosyamızın var olduğunu belirtiyor. Bu dosyamızı da templates klasörümüzün içinde search/indexes/[uygulama adı]/[model adı]_[alan adı].txt yoluna(bu örneğimiz için: templates/search/indexes/blog/blogpost_text.txt) koymamız gerekiyor:</p>
<div class="codehilite"><pre><span class="cp">{%</span> <span class="k">literal</span> <span class="cp">%}{{</span> <span class="nv">object.title</span> <span class="cp">}}</span><span class="x"></span>
<span class="cp">{{</span> <span class="nv">object.author</span> <span class="cp">}}{%</span> <span class="k">endliteral</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>


<p>Bu şekilde text alanına modelimizden başlık ve yazar bilgilerini ekleyerek indeksletmiş olduk. Bu sayede yazılarımızda hem yazar adı hem de yazı başlığı ile arama yapma imkanına sahip olacağız.</p>
<p>"Yazı başlığını text alanına eklediysek, title alanını indekse eklemeye ne gerek var?" sorusu aklınıza gelmiş olabilir. text alanında sadece birebir yazı başlığını kullansak, tekrar title alanını eklemeye gerek kalmazdı, ancak, şu durumda arama yaptıktan sonra, arama sonucu olarak başlıkları listelerken yazı başlıklarına ihtiyaç olacağı için, text alanından yazı başlığını çıkartmaya çalışmak veya her sonuç satırı için veritabanına gidip yazı başlığını alma külfetine girmemek için yazı başlığını ayrıca indekse ekledik. Unutmayalım ki, aramayı elasticsearch gibi bir ortama almaktaki en önemli amaçlarımızdan biri arama işlerini veritabanının üzerinde alarak gereksiz yük oluşturmamak.</p>
<p>İndeksleme bilgilerini girerken burada hepsine değinemeyeceğim daha bir çok imkan var. Bunları <a href="http://django-haystack.readthedocs.org/en/latest/searchindex_api.html">ilgili doküman</a>dan inceleyebilir veya özellikle merak ettiğiniz bir konu olursa bu yazıya yorum girerek sorabilirsiniz.</p>
<p>Verilerimizin ilk kez indekslenmesi için aşağıdaki komutu çalıştırmamız gerekiyor:</p>
<div class="codehilite"><pre><span class="n">python</span> <span class="n">manage</span><span class="p">.</span><span class="n">py</span> <span class="n">update_index</span> <span class="n">blog</span><span class="p">.</span><span class="n">BlogPost</span>
</pre></div>


<p>Sonda verdiğimiz model parametresi opsiyoneldir. Eğer yazmazsanız varolan bütün indeksler güncellenir. Bu komutu çalıştırmadan önce elasticsearch'ün çalıştığından emin olun.</p>
<h2>Arama sorgusu</h2>
<p>Verilerimiz indekslendiğine göre artık ilk sorgumuzu yapabiliriz. Bunun için önce bir url tanımlayalım:</p>
<div class="codehilite"><pre><span class="n">urlpatterns</span> <span class="p">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="p">(</span><span class="n">r</span><span class="o">&#39;</span>^<span class="n">blog</span><span class="o">/</span><span class="n">search</span><span class="o">/</span>$<span class="s">&#39;, &#39;</span><span class="n">blog</span><span class="p">.</span><span class="n">search</span><span class="o">&#39;</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>


<p>Bu adrese gelecek talepleri alacak view metodumuzu da uygulama klasöründeki views.py dosyamıza ekliyoruz:</p>
<div class="codehilite"><pre><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">haystack.query</span> <span class="kn">import</span> <span class="n">SearchQuerySet</span>

<span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">SearchQuerySet</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">content__startswith</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;q&#39;</span><span class="p">))[:</span><span class="mi">10</span><span class="p">]</span>
    <span class="n">results_text</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">row</span><span class="o">.</span><span class="n">title</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">results</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">results_text</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;text/plain&quot;</span><span class="p">)</span>
</pre></div>


<p>Sorgular için haystack'in SearchQuerySet'ini kullanıyoruz. Kullanımı Django'nun model query'sine oldukça benziyor. Çok benzer şekilde çalışan filter metodunu kullanarak q querystringi ile gelen metinle başlayan kelimelerin bulunduğu 10 adet kaydı çekiyoruz. Burada text__startswith yazmak yerine content ismini kullanmamız dikkatinizi çekmiştir. content ismi, haystack tarafından sunulmuş özel bir alan adı ve tüm dokümanda arama yapma imkanı veriyor. filter'da Django'da olduğu gibi indeksteki diğer alanlara özgü filtrelemeler yapmamız da mümkün. Örneğin indeksimize user alanı da eklediğimizi varsayarsak:</p>
<div class="codehilite"><pre><span class="n">SearchQuerySet</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">user__iexact</span><span class="o">=</span><span class="s">&quot;murat&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">content__startswith</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;q&#39;</span><span class="p">))[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>


<p>gibi zincirleme sorgular yapabiliriz.</p>
<p>Tüm bu işlemleri başarıyla tamamladığınızda, django uygulamamızı çalıştırıp http://127.0.0.1:8000/blog/arama/?q=django gibi arama yaptığımızda başlığında veya yazar adında django ile başlayan kelimeler bulunan yazılardan ilk 10'unun başlıklarının listelendiğini göreceksiniz.</p>
<h2>Sonuç</h2>
<p>Benim de yeni tecrübe ettiğim ve çok sevdiğim bir alanda sizinle tecrübelerimi paylaşmak istedim. Umarım faydalı olmuştur. Konuyla ilgili soru veya katkılarınızla bu yazıyı daha da faydalı bir kaynağa dönüştürebiliriz.</p>
    </div>

        <footer>
        <ul class="tags">
                    <li><a href="../../tag/django.html">django</a></li>
                    <li><a href="../../tag/python.html">python</a></li>
                    <li><a href="../../tag/haystack.html">haystack</a></li>
                    <li><a href="../../tag/elasticsearch.html">elasticsearch</a></li>
                    <li><a href="../../tag/fulltextsearch.html">fulltextsearch</a></li>
                    <li><a href="../../tag/arama.html">arama</a></li>
                </ul>
    </footer>
    
        <div class="share">
        <a href="https://twitter.com/share" class="twitter-share-button"
           data-count="horizontal" data-text=""Django'da Haystack ve Elasticsearch ile arama""
           data-via="muratcorlu">Tweet</a>
    </div>
    <script src="//platform.twitter.com/widgets.js"></script>
    
        <div id="disqus_thread"></div>
    <script>
        var disqus_identifier = "http://muratcorlu.com/post/djangoda-haystack-ve-elasticsearch-ile-arama/",
            disqus_developer = "1";

        (function () {
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.src = 'http://muratcorlu.disqus.com/embed.js';
            (document.head || document.body).appendChild(dsq);
        })();
    </script>
    </article>

<script>
    (function () {
        'use strict';
        var titleElm = document.querySelector('article > header');
        var bodyElm = document.querySelector('article > .body');
        if (!titleElm || !bodyElm)
            return;

        var limit = titleElm.offsetTop;
        var titleCls = titleElm.classList;
        var bodyCls = bodyElm.classList;
        var floating = false;
        window.onscroll = function (evt) {
            var scrollTop = Math.max(document.body.scrollTop,
                    document.documentElement.scrollTop);
            if (!floating && limit < scrollTop) {
                titleCls.add('float');
                bodyCls.add('body-padding');
                floating = true;
            }
            else if (limit >= scrollTop) {
                titleCls.remove('float');
                bodyCls.remove('body-padding');
                floating = false;
            }
        };
    })();
</script>
    </div>

    <div class="container footnote">
                            </div>

    <div class="bottom">
        <div class="container">
                        <div class="github-badge">
                <iframe src="http://githubbadge.appspot.com/badge/muratcorlu?s=1"
                        style="border: 0; height: 150px; width: 200px; overflow: hidden;"></iframe>
            </div>
                        <div class="about">
                <h3>About me</h3>
                <img alt="Me!" class="avatar"
                     src="http://www.gravatar.com/avatar/2906955ae59c795275979d3782d7bfca?size=64">
                <p>
I'm web developer at sahibinden.com. I love Javascript and Python.
</p>
                <p>
                   You can contact me by emailing
                   <a href="mailto:muratcorlu@gmail.com">muratcorlu@gmail.com</a>.
                </p>
                <p>
                                        <a href="https://twitter.com/muratcorlu"
                       title="@muratcorlu on Twitter">Follow me on Twitter</a> and
                                                            <a href="https://github.com/muratcorlu"
                       title="muratcorlu's Profile">fork me on GitHub
                    </a>!
                                    </p>
            </div>
        </div>
    </div>

    <footer>
        <div class="container footer">
            <span>Powered by <a href="http://docs.getpelican.com">
                Pelican</a> using <a href="https://github.com/BYK/pelican-neat">
                neat theme</a>.
            </span>
            <nav>
                <ul>
                    <li><a href="archives.html" title="Archive"><strong>Archive</strong></a></li>
                                    </ul>
            </nav>
                    </div>
    </footer>

        <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-790007-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    </body>
</html>